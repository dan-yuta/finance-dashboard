# Finance Dashboard

個人の資産・負債（BS）と収支（PL）を毎月記録し、視覚的にわかりやすいダッシュボードで財務の健康度を確認できるローカルHTMLアプリです。

## Tech Stack

| 技術 | 詳細 |
|------|------|
| HTML / CSS / JavaScript | フレームワーク不使用、Vanilla JS |
| Chart.js v4.4.1 | CDN経由、各種チャート描画 |
| File System Access API | ローカルファイルの読み書き |
| IndexedDB | フォルダハンドルの永続化 |

## Project Structure

```
15_家計管理/
├── index.html                  # エントリーポイント
├── 001_データ/                 # JSONデータ保存先
│   └── finance_YYYYMMDD_HHMMSS.json
├── 002_ソースファイル/
│   ├── app.js                  # アプリケーションロジック
│   └── style.css               # スタイルシート
└── README.md
```

## Getting Started

1. `index.html` をブラウザ（Chrome / Edge）で開く
2. 初回は「最新データを読み込み」ボタンから `001_データ` フォルダを選択
3. ダッシュボードに財務サマリーが表示される

> **Note**: File System Access API を使用するため、**Chrome または Edge** が必要です。Firefox / Safari では動作しません。

## App Overview

```
┌─────────────────────────────────────────────────────────────────┐
│  Finance Dashboard                    最終保存: 2026/02/28 21:30│
│  [💾 保存] [🔄 読み込み] [📤 CSV]          ● 未保存の変更あり  │
├─────────────────────────────────────────────────────────────────┤
│  📊ダッシュボード │ 💰PL詳細 │ 🏦BS詳細 │ ✏️月次入力 │ ...    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│                      (タブコンテンツ)                            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

全7タブ構成:

| タブ | 機能概要 |
|------|----------|
| 📊 ダッシュボード | 財務健康度ゲージ、サマリーカード、チャート、自動コメント |
| 💰 PL詳細 | 収入・支出の内訳テーブル、収支バランスチャート |
| 🏦 BS詳細 | 資産・負債の内訳テーブル、資産構成チャート |
| ✏️ 月次入力 | BS + PLデータの入力フォーム |
| 📈 推移グラフ | 純資産・資産vs負債・収支・ローン残高の推移 |
| 📅 年間サマリー | ヒートマップ、年間テーブル、2ヶ月比較 |
| ⚙️ 設定 | 口座・カテゴリ管理、予算・目標設定 |

---

## Features

### Dashboard - Health Score Gauge

財務の健全性を0〜100点でスコア化し、半円ゲージで表示します。

```
         ╭─────────────╮
       ╱   ╱ ╲   ╲   ╲   ╲
     ╱  赤 ╱ 橙 ╲ 黄  ╲ 緑  ╲
    ╱ 0-30╱31-50╲51-70╲71-100╲
    ╰──────────────────────────╯
              58 点
            🔶 改善中
```

| スコア | 色 | ラベル |
|--------|-----|--------|
| 0 - 30 | 赤 | 危険 |
| 31 - 50 | 橙 | 注意 |
| 51 - 70 | 黄 | 改善中 |
| 71 - 100 | 緑 | 良好 |

**計算ロジック**:
- 純資産トレンド（40点）: 前月比で増加していれば高スコア
- 負債比率（30点）: 総資産に対する負債の割合が低いほど高スコア
- 月次収支（30点）: 黒字であれば高スコア

---

### Dashboard - Summary Cards with Sparklines & Badges

4枚のサマリーカードに、ミニスパークライン（直近6ヶ月の推移）と前月比パーセントバッジを表示します。

```
┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│  💎 純資産    │ │  💰 総資産    │ │  💳 総負債    │ │  📊 月間収支  │
│              │ │              │ │              │ │              │
│ -¥2,963,698  │ │  ¥502,454   │ │ ¥3,466,152  │ │  -¥104,000  │
│   ▁▂▃▂▁▂    │ │   ▃▄▅▄▃▄    │ │   ▇▆▅▆▇▆    │ │   ▃▂▁▂▃▂    │
│         +2.1%│ │        -0.5%│ │        -1.2%│ │       +15.3%│
└──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘
```

- **ミニスパークライン**: SVGで描画された直近6ヶ月の推移を各カード下部に表示
- **前月比バッジ**: 増加は緑（▲）、減少は赤（▼）のバッジで前月からの変動率を表示

---

### Dashboard - Loan Payoff Countdown

ローン返済の進捗をプログレスバーとカウントダウンで可視化します。

```
┌─────────────────────────────────────────────────┐
│  🏦 ローン返済進捗                               │
│  ████████░░░░░░░░░░░░░░░░░░░░░░  25.3%         │
│  ┌──────────┬──────────┬──────────┐             │
│  │ ¥0       │ ¥3.4M    │ ¥23,108  │             │
│  │ 返済済み  │ 残高     │ 月間利息  │             │
│  └──────────┴──────────┴──────────┘             │
└─────────────────────────────────────────────────┘
```

- 返済進捗率をグラデーションバーで表示
- 残高・返済済み額・月間利息の3つのメトリクスを表示
- 2ヶ月以上のデータが溜まると、実績ベースで完済予測（残り月数・完済予定）を自動算出

---

### Dashboard - Budget & Goal Progress

月間予算の消化率と、設定した目標への達成率を表示します。

```
┌─ 💰 予算進捗（当月）──────────────────────┐
│                                           │
│  🏠 生活固定費    ██████████████░░  87%   │
│                   ¥104,000 / ¥120,000     │
│                                           │
│  💳 クレカ利用    ████░░░░░░░░░░░░  25%   │
│                   ¥50,000 / ¥200,000      │
└───────────────────────────────────────────┘

┌─ 🎯 目標進捗 ────────────────────────────┐
│                                           │
│  🏦 ローン完済    ████████░░░░░░░░  53%   │
│                   目標: 2028年12月         │
│                                           │
│  💰 貯蓄100万円   ██░░░░░░░░░░░░░░  12%   │
│                   目標: 2027年6月          │
└───────────────────────────────────────────┘
```

- 予算: 支出カテゴリごとに設定した月間予算に対する消化率
- 目標: ローン完済・貯蓄目標などのマイルストーンへの進捗

---

### Dashboard - Traffic Light Indicators

3つの主要指標を信号機で直感的に表示します。

```
  純資産トレンド     負債比率        月次収支
     🟢              🟡              🔴
     良好            注意             危険
```

---

### Dashboard - Auto Commentary

データに基づいて絵文字付きの自動コメントを生成し、財務状況をわかりやすく解説します。

```
┌─ 💬 自動コメント ─────────────────────────────┐
│                                               │
│  😰 純資産がマイナスです。負債の返済を優先      │
│     しましょう。                               │
│  📈 先月より純資産が改善しています！           │
│  🎯 ローン完済まであと約4年です。              │
│  💡 月の支出が収入を上回っています。           │
│                                               │
└───────────────────────────────────────────────┘
```

---

### Monthly Input - Validation & Navigation

月次入力タブに、入力バリデーションと月ナビゲーションを搭載。

```
┌─ ✏️ 月次入力 ─────────────────────────────────┐
│                                               │
│    ◀  2026年02月  ▶     [📋 前月コピー]       │
│                                               │
│  ── 資産（BS）──────────────────────────────  │
│  🏦 楽天銀行     [  437,468 ] 前月: 420,000   │
│                               差分: +17,468   │
│                                               │
│  🏦 みずほ銀行   [   40,836 ] 前月:  45,000   │
│                               差分:  -4,164   │
│                     ⚠️ 負の値は入力できません    │
│                                               │
│  ── 支出（PL）──────────────────────────────  │
│  🏠 生活固定費   [  104,000 ] 前月: 104,000   │
│                               差分:       0   │
│                                               │
│              [💾 この月のデータを保存]          │
└───────────────────────────────────────────────┘
```

- **◀▶ ナビゲーション**: 全タブの年月セレクターに前月・翌月ボタンを配置
- **バリデーション**: 負の値や前月比50%以上の変動時に警告を表示

---

### Yearly Summary - Heatmap Calendar

年間の収支を月別ヒートマップで色分け表示します。

```
┌─ 📅 年間サマリー ── 2026年 ───────────────────┐
│                                               │
│   1月   2月   3月   4月   5月   6月           │
│  ┌────┐┌────┐┌────┐┌────┐┌────┐┌────┐        │
│  │ 🟩 ││ 🟥 ││ 🟨 ││ 🟩 ││ 🟩 ││ ⬜ │        │
│  │+12万││-10万││ -2万││+15万││ +8万││ -- │        │
│  └────┘└────┘└────┘└────┘└────┘└────┘        │
│                                               │
│   7月   8月   9月  10月  11月  12月           │
│  ┌────┐┌────┐┌────┐┌────┐┌────┐┌────┐        │
│  │ ⬜ ││ ⬜ ││ ⬜ ││ ⬜ ││ ⬜ ││ ⬜ │        │
│  │ -- ││ -- ││ -- ││ -- ││ -- ││ -- │        │
│  └────┘└────┘└────┘└────┘└────┘└────┘        │
│                                               │
│  🟩 黒字  🟨 微赤字  🟥 赤字  ⬜ データなし    │
└───────────────────────────────────────────────┘
```

---

### Yearly Summary - Data Table

年間の全月データをテーブルで一覧表示。年間合計も自動計算されます。

```
┌──────┬──────────┬──────────┬──────────┬──────────┐
│ 月   │  総資産   │  総負債   │  純資産   │ 月次収支  │
├──────┼──────────┼──────────┼──────────┼──────────┤
│ 1月  │  ¥520K  │ ¥3,500K │ -¥2,980K │  +¥120K │
│ 2月  │  ¥502K  │ ¥3,466K │ -¥2,964K │  -¥104K │
│ ...  │   ...    │   ...    │   ...    │   ...    │
├──────┼──────────┼──────────┼──────────┼──────────┤
│ 合計 │    -     │    -     │    -     │  +¥16K  │
└──────┴──────────┴──────────┴──────────┴──────────┘
```

---

### Yearly Summary - 2-Month Comparison

任意の2ヶ月を選択して、BS・PLを並べて比較できます。

```
┌─ 比較 ────────────────────────────────────────┐
│                                               │
│  [2026-01 ▼]  vs  [2026-02 ▼]  [比較実行]    │
│                                               │
│  ┌─────────────┬──────────┬──────────┬──────┐ │
│  │  項目        │  1月     │  2月     │ 差分  │ │
│  ├─────────────┼──────────┼──────────┼──────┤ │
│  │ 楽天銀行     │ ¥420K   │ ¥437K   │ +¥17K│ │
│  │ 三井住友ローン│ ¥3,500K │ ¥3,466K │ -¥34K│ │
│  │ 生活固定費   │ ¥104K   │ ¥104K   │   ¥0 │ │
│  └─────────────┴──────────┴──────────┴──────┘ │
└───────────────────────────────────────────────┘
```

---

### Trend Charts

4種類の推移グラフを Chart.js で描画します。

```
┌─ 📈 推移グラフ ───────────────────────────────┐
│                                               │
│  ┌─ 純資産推移 ──────────┐ ┌─ 資産vs負債 ───┐ │
│  │         ╱╲            │ │  ▓▓  ░░        │ │
│  │    ╱╲╱╱  ╲           │ │  ▓▓  ░░  ▓▓    │ │
│  │ ──╱────────╲── 0     │ │  ▓▓  ░░  ▓▓ ░░ │ │
│  │╱╱            ╲       │ │  ▓▓  ░░  ▓▓ ░░ │ │
│  └───────────────────────┘ └────────────────┘ │
│                                               │
│  ┌─ 月次収支 ───────────┐ ┌─ ローン残高 ────┐ │
│  │  ▓▓      ▓▓         │ │ ╲               │ │
│  │  ▓▓  ░░  ▓▓  ░░     │ │  ╲              │ │
│  │ ─▓▓──░░──▓▓──░░─ 0  │ │   ╲ ╲ ╲ ╲ (予測)│ │
│  │      ░░      ░░     │ │              ╲   │ │
│  └───────────────────────┘ └────────────────┘ │
│                                               │
│  ▓▓ 資産/黒字   ░░ 負債/赤字   ╲╲ 予測線     │
└───────────────────────────────────────────────┘
```

---

### CSV Export

全月データをCSV形式でエクスポートできます。

- BOM付きUTF-8で出力（日本語環境のExcelで文字化けしない）
- ヘッダーに「📤 CSVエクスポート」ボタンを配置

---

### Unsaved Changes Warning

データ変更後にページを離れようとすると、ブラウザの確認ダイアログを表示します。

```
┌─────────────────────────────────────────────────┐
│  Finance Dashboard        ● 未保存の変更あり     │
│  [💾 保存] [🔄 読み込み]  最終保存: 2026/02/28   │
└─────────────────────────────────────────────────┘
         │
         ▼  ページを離れようとすると...
┌─────────────────────────────────────┐
│  ⚠️ このサイトを離れますか？          │
│  行った変更が保存されない可能性が     │
│  あります。                          │
│           [キャンセル] [離れる]       │
└─────────────────────────────────────┘
```

- ヘッダーに「● 未保存の変更あり」インジケーターを表示
- 最終保存日時を常時表示

---

### Settings - Budget & Goal Management

月間予算とマイルストーン目標を設定・管理できます。

```
┌─ ⚙️ 設定 ────────────────────────────────────┐
│                                               │
│  ── 月間予算設定 ──────────────────────────── │
│  🏠 生活固定費   [  120,000 ]  [保存]         │
│  💳 クレカ利用   [  200,000 ]  [保存]         │
│                                               │
│  ── 目標設定 ──────────────────────────────── │
│  📝 目標名     [ローン完済        ]           │
│  🎯 目標額     [  3,466,152      ]           │
│  📅 期限       [  2028-12        ]           │
│                          [➕ 目標を追加]       │
│                                               │
│  ┌──────────────────────────────────────┐     │
│  │ 🏦 ローン完済  目標: ¥3.4M  2028/12 │ [🗑]│
│  │ 💰 貯蓄100万   目標: ¥1.0M  2027/06 │ [🗑]│
│  └──────────────────────────────────────┘     │
└───────────────────────────────────────────────┘
```

---

## Data Management

| 操作 | 詳細 |
|------|------|
| 保存 | `001_データ/finance_YYYYMMDD_HHMMSS.json` にタイムスタンプ付きで保存 |
| 読み込み | 起動時にフォルダ内の最新JSONを自動読み込み |
| バックアップ | 上書きされないため、過去データはすべて保持される |
| エクスポート | CSVファイルとして全月データを出力可能 |

## Monthly Workflow

```
  ① アプリを開く ──→ ② 月次入力タブ ──→ ③ 前月コピー
                                              │
  ⑦ ダッシュボード  ←── ⑥ データ保存  ←── ④ 値を修正
      で確認              (💾ボタン)          │
                                         ⑤ 月データ保存
```

## Requirements

- **Chrome** または **Edge**（File System Access API 必須）
- Firefox / Safari は非対応
- データはすべてローカルに保存され、外部には送信されません
